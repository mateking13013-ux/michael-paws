---
// ContactPopup component - Modal popup for contacting about puppies
---

<div id="contact-popup" class="popup-overlay" aria-hidden="true">
  <div class="popup-container">
    <button class="popup-close" aria-label="Close popup">&times;</button>

    <div class="popup-puppy-preview" id="popup-puppy-preview" style="display: none;">
      <div class="puppy-preview-image">
        <img id="popup-puppy-image" src="" alt="Puppy">
      </div>
      <div class="puppy-preview-info">
        <span class="puppy-status-badge">Available</span>
        <h3 id="popup-puppy-title">Puppy Name</h3>
        <p id="popup-puppy-details">Details</p>
        <div class="puppy-price-row">
          <span class="puppy-price">$800</span>
          <span class="puppy-includes">Includes paperwork & starter kit</span>
        </div>
        <div class="puppy-guarantee">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
          <span>1-Year Health Guarantee</span>
        </div>
      </div>
    </div>

    <div class="popup-header">
      <h2 class="popup-title">Take Home <span id="popup-puppy-name">This Puppy</span></h2>
      <p class="popup-subtitle">Fill out the form below and we'll contact you with next steps to bring this puppy home!</p>
    </div>

    <form id="popup-contact-form" class="popup-form">
      <input type="hidden" name="access_key" value="dbb568ae-a29f-4450-b284-00eb05527be7">
      <input type="hidden" name="subject" id="form-subject" value="Puppy Inquiry">
      <input type="hidden" name="from_name" value="Michael Paws Website">
      <input type="hidden" name="Puppy_Interested_In" id="form-puppy-name" value="">
      <input type="hidden" name="Source_Page" id="form-source-page" value="">

      <div class="form-row">
        <div class="form-group">
          <label for="popup-name">Your Name *</label>
          <input type="text" id="popup-name" name="name" required>
        </div>
        <div class="form-group">
          <label for="popup-email">Email Address *</label>
          <input type="email" id="popup-email" name="email" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="popup-phone">Phone Number</label>
          <input type="tel" id="popup-phone" name="phone">
        </div>
        <div class="form-group">
          <label for="popup-location">Your Location</label>
          <input type="text" id="popup-location" name="location">
        </div>
      </div>

      <div class="form-group full-width">
        <label for="popup-message">Message *</label>
        <textarea id="popup-message" name="message" rows="4" required></textarea>
      </div>

      <button type="submit" class="popup-submit">
        <span class="btn-text">Send Inquiry</span>
        <span class="btn-loading" style="display: none;">Sending...</span>
      </button>
    </form>

    <div id="popup-success" class="popup-success" style="display: none;">
      <div class="success-icon">
        <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
      </div>
      <h3>Thank You!</h3>
      <p>Your inquiry has been sent successfully. We'll get back to you within 24 hours.</p>
      <button class="popup-close-btn" onclick="closeContactPopup()">Close</button>
    </div>
  </div>
</div>

<script is:inline>
  function openContactPopup(puppyName, puppyImage, puppyDetails) {
    const popup = document.getElementById('contact-popup');
    const puppyNameSpan = document.getElementById('popup-puppy-name');
    const formSubject = document.getElementById('form-subject');
    const formPuppyName = document.getElementById('form-puppy-name');
    const formSourcePage = document.getElementById('form-source-page');
    const puppyPreview = document.getElementById('popup-puppy-preview');
    const puppyImageEl = document.getElementById('popup-puppy-image');
    const puppyTitle = document.getElementById('popup-puppy-title');
    const puppyDetailsEl = document.getElementById('popup-puppy-details');

    // Set source page URL
    formSourcePage.value = window.location.href;

    if (puppyName) {
      puppyNameSpan.textContent = puppyName;
      formSubject.value = `Take Home Request: ${puppyName} - Michael Paws`;
      formPuppyName.value = puppyName;
    } else {
      puppyNameSpan.textContent = 'Our Puppies';
      formSubject.value = 'New Puppy Inquiry - Michael Paws';
      formPuppyName.value = 'General Inquiry';
    }

    // Show puppy preview if image provided
    if (puppyImage) {
      puppyImageEl.src = puppyImage;
      puppyImageEl.alt = puppyName;
      puppyTitle.textContent = puppyName;
      puppyDetailsEl.textContent = puppyDetails || '';
      puppyPreview.style.display = 'flex';
    } else {
      puppyPreview.style.display = 'none';
    }

    popup.setAttribute('aria-hidden', 'false');
    popup.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeContactPopup() {
    const popup = document.getElementById('contact-popup');
    const form = document.getElementById('popup-contact-form');
    const successDiv = document.getElementById('popup-success');

    popup.setAttribute('aria-hidden', 'true');
    popup.classList.remove('active');
    document.body.style.overflow = '';

    // Reset form after animation
    setTimeout(() => {
      form.reset();
      form.style.display = 'block';
      successDiv.style.display = 'none';
    }, 300);
  }

  // Close popup on overlay click
  document.getElementById('contact-popup').addEventListener('click', function(e) {
    if (e.target === this) {
      closeContactPopup();
    }
  });

  // Close popup on escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeContactPopup();
    }
  });

  // Close button
  document.querySelector('.popup-close').addEventListener('click', closeContactPopup);

  // Form submission
  document.getElementById('popup-contact-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = this;
    const submitBtn = form.querySelector('.popup-submit');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    const successDiv = document.getElementById('popup-success');

    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
    submitBtn.disabled = true;

    try {
      const formData = new FormData(form);
      const response = await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        form.style.display = 'none';
        successDiv.style.display = 'block';
      } else {
        alert('Something went wrong. Please try again.');
      }
    } catch (error) {
      alert('Something went wrong. Please try again.');
    } finally {
      btnText.style.display = 'inline';
      btnLoading.style.display = 'none';
      submitBtn.disabled = false;
    }
  });
</script>

<style>
  .popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    padding: 1rem;
  }

  .popup-puppy-preview {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    background: #F0F4F8;
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
    border: 2px solid #1B2A4A;
  }

  .puppy-preview-image {
    width: 180px;
    height: 180px;
    border-radius: 12px;
    overflow: hidden;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .puppy-preview-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .puppy-preview-info {
    flex: 1;
  }

  .puppy-status-badge {
    display: inline-block;
    background: #1B2A4A;
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    padding: 0.25rem 0.6rem;
    border-radius: 4px;
    margin-bottom: 0.5rem;
  }

  .puppy-preview-info h3 {
    font-size: 1.35rem;
    font-weight: 700;
    color: #1B2A4A;
    margin: 0 0 0.25rem;
  }

  .puppy-preview-info p {
    font-size: 0.9rem;
    color: #555;
    margin: 0 0 0.75rem;
    line-height: 1.4;
  }

  .puppy-price-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
    flex-wrap: wrap;
  }

  .puppy-price {
    font-size: 1.25rem;
    font-weight: 800;
    color: #2a2a2a;
  }

  .puppy-includes {
    font-size: 0.75rem;
    color: #888;
  }

  .puppy-guarantee {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    color: #1B2A4A;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .puppy-guarantee svg {
    width: 16px;
    height: 16px;
  }

  .popup-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .popup-container {
    background: white;
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    transform: translateY(-20px);
    transition: transform 0.3s ease;
    padding: 2rem;
  }

  .popup-overlay.active .popup-container {
    transform: translateY(0);
  }

  .popup-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: #f5f5f5;
    border: none;
    font-size: 1.5rem;
    color: #666;
    cursor: pointer;
    line-height: 1;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .popup-close:hover {
    background: #1B2A4A;
    color: white;
  }

  .popup-header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .popup-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2a2a2a;
    margin: 0 0 0.5rem;
  }

  .popup-title span {
    color: #1B2A4A;
  }

  .popup-subtitle {
    font-size: 0.95rem;
    color: #666;
    margin: 0;
  }

  .popup-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  .form-group label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #333;
  }

  .form-group input,
  .form-group textarea {
    padding: 0.75rem 1rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #1B2A4A;
    box-shadow: 0 0 0 3px rgba(9, 81, 54, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
  }

  .popup-submit {
    background: #1B2A4A;
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    margin-top: 0.5rem;
  }

  .popup-submit:hover {
    background: #2E8B8B;
  }

  .popup-submit:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  .popup-success {
    text-align: center;
    padding: 2rem 0;
  }

  .success-icon {
    width: 60px;
    height: 60px;
    background: #1B2A4A;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
  }

  .success-icon svg {
    width: 30px;
    height: 30px;
    fill: white;
  }

  .popup-success h3 {
    font-size: 1.5rem;
    color: #2a2a2a;
    margin: 0 0 0.5rem;
  }

  .popup-success p {
    color: #666;
    margin: 0 0 1.5rem;
  }

  .popup-close-btn {
    background: #1B2A4A;
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .popup-close-btn:hover {
    background: #2E8B8B;
  }

  @media (max-width: 600px) {
    .popup-container {
      padding: 1.5rem;
    }

    .form-row {
      grid-template-columns: 1fr;
    }

    .popup-title {
      font-size: 1.25rem;
    }
  }
</style>
